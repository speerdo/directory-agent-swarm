import { getDb } from '../packages/core/src/db/client.js';
import { createLogger } from '../packages/core/src/utils/logger.js';

const logger = createLogger('seed-cities');

// Top US cities by population with coordinates
const CITIES = [
  { name: 'New York', state_code: 'NY', state_name: 'New York', population: 8336817, lat: 40.7128, lng: -74.0060 },
  { name: 'Los Angeles', state_code: 'CA', state_name: 'California', population: 3979576, lat: 34.0522, lng: -118.2437 },
  { name: 'Chicago', state_code: 'IL', state_name: 'Illinois', population: 2746388, lat: 41.8781, lng: -87.6298 },
  { name: 'Houston', state_code: 'TX', state_name: 'Texas', population: 2320268, lat: 29.7604, lng: -95.3698 },
  { name: 'Phoenix', state_code: 'AZ', state_name: 'Arizona', population: 1680992, lat: 33.4484, lng: -112.0740 },
  { name: 'Philadelphia', state_code: 'PA', state_name: 'Pennsylvania', population: 1584064, lat: 39.9526, lng: -75.1652 },
  { name: 'San Antonio', state_code: 'TX', state_name: 'Texas', population: 1547253, lat: 29.4241, lng: -98.4936 },
  { name: 'San Diego', state_code: 'CA', state_name: 'California', population: 1423851, lat: 32.7157, lng: -117.1611 },
  { name: 'Dallas', state_code: 'TX', state_name: 'Texas', population: 1343573, lat: 32.7767, lng: -96.7970 },
  { name: 'San Jose', state_code: 'CA', state_name: 'California', population: 1021795, lat: 37.3382, lng: -121.8863 },
  { name: 'Austin', state_code: 'TX', state_name: 'Texas', population: 978908, lat: 30.2672, lng: -97.7431 },
  { name: 'Jacksonville', state_code: 'FL', state_name: 'Florida', population: 911507, lat: 30.3322, lng: -81.6557 },
  { name: 'Fort Worth', state_code: 'TX', state_name: 'Texas', population: 909585, lat: 32.7555, lng: -97.3308 },
  { name: 'Columbus', state_code: 'OH', state_name: 'Ohio', population: 898553, lat: 39.9612, lng: -82.9988 },
  { name: 'Charlotte', state_code: 'NC', state_name: 'North Carolina', population: 885708, lat: 35.2271, lng: -80.8431 },
  { name: 'San Francisco', state_code: 'CA', state_name: 'California', population: 883305, lat: 37.7749, lng: -122.4194 },
  { name: 'Indianapolis', state_code: 'IN', state_name: 'Indiana', population: 867125, lat: 39.7684, lng: -86.1581 },
  { name: 'Seattle', state_code: 'WA', state_name: 'Washington', population: 753675, lat: 47.6062, lng: -122.3321 },
  { name: 'Denver', state_code: 'CO', state_name: 'Colorado', population: 727211, lat: 39.7392, lng: -104.9903 },
  { name: 'Washington', state_code: 'DC', state_name: 'District of Columbia', population: 705749, lat: 38.9072, lng: -77.0369 },
  { name: 'Boston', state_code: 'MA', state_name: 'Massachusetts', population: 692600, lat: 42.3601, lng: -71.0589 },
  { name: 'El Paso', state_code: 'TX', state_name: 'Texas', population: 681728, lat: 31.7619, lng: -106.4850 },
  { name: 'Nashville', state_code: 'TN', state_name: 'Tennessee', population: 670820, lat: 36.1627, lng: -86.7816 },
  { name: 'Detroit', state_code: 'MI', state_name: 'Michigan', population: 670031, lat: 42.3314, lng: -83.0458 },
  { name: 'Oklahoma City', state_code: 'OK', state_name: 'Oklahoma', population: 655057, lat: 35.4676, lng: -97.5164 },
  { name: 'Portland', state_code: 'OR', state_name: 'Oregon', population: 654741, lat: 45.5051, lng: -122.6750 },
  { name: 'Las Vegas', state_code: 'NV', state_name: 'Nevada', population: 651319, lat: 36.1699, lng: -115.1398 },
  { name: 'Memphis', state_code: 'TN', state_name: 'Tennessee', population: 650618, lat: 35.1495, lng: -90.0490 },
  { name: 'Louisville', state_code: 'KY', state_name: 'Kentucky', population: 617638, lat: 38.2527, lng: -85.7585 },
  { name: 'Baltimore', state_code: 'MD', state_name: 'Maryland', population: 593490, lat: 39.2904, lng: -76.6122 },
  { name: 'Milwaukee', state_code: 'WI', state_name: 'Wisconsin', population: 577222, lat: 43.0389, lng: -87.9065 },
  { name: 'Albuquerque', state_code: 'NM', state_name: 'New Mexico', population: 560218, lat: 35.0844, lng: -106.6504 },
  { name: 'Tucson', state_code: 'AZ', state_name: 'Arizona', population: 548073, lat: 32.2226, lng: -110.9747 },
  { name: 'Fresno', state_code: 'CA', state_name: 'California', population: 531576, lat: 36.7378, lng: -119.7871 },
  { name: 'Sacramento', state_code: 'CA', state_name: 'California', population: 508529, lat: 38.5816, lng: -121.4944 },
  { name: 'Mesa', state_code: 'AZ', state_name: 'Arizona', population: 508958, lat: 33.4152, lng: -111.8315 },
  { name: 'Kansas City', state_code: 'MO', state_name: 'Missouri', population: 495327, lat: 39.0997, lng: -94.5786 },
  { name: 'Atlanta', state_code: 'GA', state_name: 'Georgia', population: 498715, lat: 33.7490, lng: -84.3880 },
  { name: 'Miami', state_code: 'FL', state_name: 'Florida', population: 467963, lat: 25.7617, lng: -80.1918 },
  { name: 'Raleigh', state_code: 'NC', state_name: 'North Carolina', population: 474069, lat: 35.7796, lng: -78.6382 },
  { name: 'Omaha', state_code: 'NE', state_name: 'Nebraska', population: 468262, lat: 41.2565, lng: -95.9345 },
  { name: 'Colorado Springs', state_code: 'CO', state_name: 'Colorado', population: 472688, lat: 38.8339, lng: -104.8214 },
  { name: 'Virginia Beach', state_code: 'VA', state_name: 'Virginia', population: 459470, lat: 36.8529, lng: -75.9780 },
  { name: 'Long Beach', state_code: 'CA', state_name: 'California', population: 467354, lat: 33.7701, lng: -118.1937 },
  { name: 'Oakland', state_code: 'CA', state_name: 'California', population: 433031, lat: 37.8044, lng: -122.2712 },
  { name: 'Minneapolis', state_code: 'MN', state_name: 'Minnesota', population: 425403, lat: 44.9778, lng: -93.2650 },
  { name: 'Tulsa', state_code: 'OK', state_name: 'Oklahoma', population: 401190, lat: 36.1540, lng: -95.9928 },
  { name: 'Tampa', state_code: 'FL', state_name: 'Florida', population: 399700, lat: 27.9506, lng: -82.4572 },
  { name: 'Arlington', state_code: 'TX', state_name: 'Texas', population: 398854, lat: 32.7357, lng: -97.1081 },
  { name: 'New Orleans', state_code: 'LA', state_name: 'Louisiana', population: 390144, lat: 29.9511, lng: -90.0715 },
  { name: 'Wichita', state_code: 'KS', state_name: 'Kansas', population: 389938, lat: 37.6872, lng: -97.3301 },
  { name: 'Cleveland', state_code: 'OH', state_name: 'Ohio', population: 381009, lat: 41.4993, lng: -81.6944 },
  { name: 'Bakersfield', state_code: 'CA', state_name: 'California', population: 384145, lat: 35.3733, lng: -119.0187 },
  { name: 'Aurora', state_code: 'CO', state_name: 'Colorado', population: 379289, lat: 39.7294, lng: -104.8319 },
  { name: 'Anaheim', state_code: 'CA', state_name: 'California', population: 350365, lat: 33.8366, lng: -117.9143 },
  { name: 'Honolulu', state_code: 'HI', state_name: 'Hawaii', population: 350964, lat: 21.3069, lng: -157.8583 },
  { name: 'Santa Ana', state_code: 'CA', state_name: 'California', population: 332318, lat: 33.7455, lng: -117.8677 },
  { name: 'Corpus Christi', state_code: 'TX', state_name: 'Texas', population: 326586, lat: 27.8006, lng: -97.3964 },
  { name: 'Riverside', state_code: 'CA', state_name: 'California', population: 330063, lat: 33.9806, lng: -117.3755 },
  { name: 'St. Louis', state_code: 'MO', state_name: 'Missouri', population: 300576, lat: 38.6270, lng: -90.1994 },
  { name: 'Lexington', state_code: 'KY', state_name: 'Kentucky', population: 323152, lat: 38.0406, lng: -84.5037 },
  { name: 'Stockton', state_code: 'CA', state_name: 'California', population: 312697, lat: 37.9577, lng: -121.2908 },
  { name: 'Pittsburgh', state_code: 'PA', state_name: 'Pennsylvania', population: 300286, lat: 40.4406, lng: -79.9959 },
  { name: 'Saint Paul', state_code: 'MN', state_name: 'Minnesota', population: 308096, lat: 44.9537, lng: -93.0900 },
  { name: 'Anchorage', state_code: 'AK', state_name: 'Alaska', population: 291247, lat: 61.2181, lng: -149.9003 },
  { name: 'Cincinnati', state_code: 'OH', state_name: 'Ohio', population: 309317, lat: 39.1031, lng: -84.5120 },
  { name: 'Henderson', state_code: 'NV', state_name: 'Nevada', population: 302539, lat: 36.0395, lng: -114.9817 },
  { name: 'Greensboro', state_code: 'NC', state_name: 'North Carolina', population: 296710, lat: 36.0726, lng: -79.7920 },
  { name: 'Plano', state_code: 'TX', state_name: 'Texas', population: 287677, lat: 33.0198, lng: -96.6969 },
  { name: 'Newark', state_code: 'NJ', state_name: 'New Jersey', population: 282011, lat: 40.7357, lng: -74.1724 },
  { name: 'Lincoln', state_code: 'NE', state_name: 'Nebraska', population: 291082, lat: 40.8136, lng: -96.7026 },
  { name: 'Toledo', state_code: 'OH', state_name: 'Ohio', population: 275243, lat: 41.6528, lng: -83.5379 },
  { name: 'Orlando', state_code: 'FL', state_name: 'Florida', population: 287442, lat: 28.5383, lng: -81.3792 },
  { name: 'Chula Vista', state_code: 'CA', state_name: 'California', population: 274492, lat: 32.6401, lng: -117.0842 },
  { name: 'Jersey City', state_code: 'NJ', state_name: 'New Jersey', population: 262652, lat: 40.7178, lng: -74.0431 },
  { name: 'Chandler', state_code: 'AZ', state_name: 'Arizona', population: 257165, lat: 33.3062, lng: -111.8413 },
  { name: 'Fort Wayne', state_code: 'IN', state_name: 'Indiana', population: 264488, lat: 41.0793, lng: -85.1394 },
  { name: 'Buffalo', state_code: 'NY', state_name: 'New York', population: 255284, lat: 42.8864, lng: -78.8784 },
  { name: 'Durham', state_code: 'NC', state_name: 'North Carolina', population: 257592, lat: 35.9940, lng: -78.8986 },
  { name: 'St. Petersburg', state_code: 'FL', state_name: 'Florida', population: 265351, lat: 27.7676, lng: -82.6403 },
  { name: 'Irvine', state_code: 'CA', state_name: 'California', population: 287401, lat: 33.6846, lng: -117.8265 },
  { name: 'Laredo', state_code: 'TX', state_name: 'Texas', population: 262495, lat: 27.5306, lng: -99.4803 },
  { name: 'Lubbock', state_code: 'TX', state_name: 'Texas', population: 260993, lat: 33.5779, lng: -101.8552 },
  { name: 'Madison', state_code: 'WI', state_name: 'Wisconsin', population: 269840, lat: 43.0731, lng: -89.4012 },
  { name: 'Gilbert', state_code: 'AZ', state_name: 'Arizona', population: 257658, lat: 33.3528, lng: -111.7890 },
  { name: 'Reno', state_code: 'NV', state_name: 'Nevada', population: 255601, lat: 39.5296, lng: -119.8138 },
  { name: 'Hialeah', state_code: 'FL', state_name: 'Florida', population: 238942, lat: 25.8576, lng: -80.2781 },
  { name: 'Garland', state_code: 'TX', state_name: 'Texas', population: 239928, lat: 32.9126, lng: -96.6389 },
  { name: 'Scottsdale', state_code: 'AZ', state_name: 'Arizona', population: 258069, lat: 33.4942, lng: -111.9261 },
  { name: 'Irving', state_code: 'TX', state_name: 'Texas', population: 243840, lat: 32.8140, lng: -96.9489 },
  { name: 'North Las Vegas', state_code: 'NV', state_name: 'Nevada', population: 251974, lat: 36.1989, lng: -115.1175 },
  { name: 'Winston-Salem', state_code: 'NC', state_name: 'North Carolina', population: 247945, lat: 36.0999, lng: -80.2442 },
  { name: 'Glendale', state_code: 'AZ', state_name: 'Arizona', population: 250717, lat: 33.5387, lng: -112.1859 },
  { name: 'Boise', state_code: 'ID', state_name: 'Idaho', population: 235684, lat: 43.6150, lng: -116.2023 },
  { name: 'Richmond', state_code: 'VA', state_name: 'Virginia', population: 230436, lat: 37.5407, lng: -77.4360 },
  { name: 'Fremont', state_code: 'CA', state_name: 'California', population: 237807, lat: 37.5485, lng: -121.9886 },
  { name: 'Batavia', state_code: 'NY', state_name: 'New York', population: 17611, lat: 42.9981, lng: -78.1878 },
  { name: 'Des Moines', state_code: 'IA', state_name: 'Iowa', population: 214237, lat: 41.5868, lng: -93.6250 },
  { name: 'Spokane', state_code: 'WA', state_name: 'Washington', population: 228989, lat: 47.6588, lng: -117.4260 },
  { name: 'Tacoma', state_code: 'WA', state_name: 'Washington', population: 216903, lat: 47.2529, lng: -122.4443 },
  { name: 'Modesto', state_code: 'CA', state_name: 'California', population: 214221, lat: 37.6391, lng: -120.9969 },
  { name: 'Fontana', state_code: 'CA', state_name: 'California', population: 214547, lat: 34.0922, lng: -117.4350 },
  { name: 'Moreno Valley', state_code: 'CA', state_name: 'California', population: 212570, lat: 33.9425, lng: -117.2297 },
  { name: 'Shreveport', state_code: 'LA', state_name: 'Louisiana', population: 192036, lat: 32.5250, lng: -93.7502 },
  { name: 'Fayetteville', state_code: 'NC', state_name: 'North Carolina', population: 211657, lat: 35.0527, lng: -78.8784 },
  { name: 'Worcester', state_code: 'MA', state_name: 'Massachusetts', population: 185174, lat: 42.2626, lng: -71.8023 },
  { name: 'Port St. Lucie', state_code: 'FL', state_name: 'Florida', population: 201846, lat: 27.2730, lng: -80.3582 },
  { name: 'Pembroke Pines', state_code: 'FL', state_name: 'Florida', population: 172374, lat: 26.0033, lng: -80.2962 },
  { name: 'Grand Prairie', state_code: 'TX', state_name: 'Texas', population: 194543, lat: 32.7459, lng: -96.9978 },
  { name: 'Peoria', state_code: 'AZ', state_name: 'Arizona', population: 190985, lat: 33.5806, lng: -112.2374 },
  { name: 'Huntsville', state_code: 'AL', state_name: 'Alabama', population: 202064, lat: 34.7304, lng: -86.5861 },
  { name: 'Sioux Falls', state_code: 'SD', state_name: 'South Dakota', population: 192517, lat: 43.5460, lng: -96.7313 },
  { name: 'Springfield', state_code: 'MO', state_name: 'Missouri', population: 166810, lat: 37.2090, lng: -93.2923 },
  { name: 'Knoxville', state_code: 'TN', state_name: 'Tennessee', population: 190223, lat: 35.9606, lng: -83.9207 },
  { name: 'Vancouver', state_code: 'WA', state_name: 'Washington', population: 186192, lat: 45.6387, lng: -122.6615 },
  { name: 'Brownsville', state_code: 'TX', state_name: 'Texas', population: 182110, lat: 25.9017, lng: -97.4975 },
  { name: 'Mobile', state_code: 'AL', state_name: 'Alabama', population: 188720, lat: 30.6954, lng: -88.0399 },
  { name: 'Fort Lauderdale', state_code: 'FL', state_name: 'Florida', population: 181668, lat: 26.1224, lng: -80.1373 },
  { name: 'Providence', state_code: 'RI', state_name: 'Rhode Island', population: 179883, lat: 41.8240, lng: -71.4128 },
  { name: 'Ontario', state_code: 'CA', state_name: 'California', population: 175265, lat: 34.0633, lng: -117.6509 },
  { name: 'Chattanooga', state_code: 'TN', state_name: 'Tennessee', population: 180557, lat: 35.0458, lng: -85.3097 },
  { name: 'Newport News', state_code: 'VA', state_name: 'Virginia', population: 179225, lat: 37.0871, lng: -76.4730 },
  { name: 'Santa Clarita', state_code: 'CA', state_name: 'California', population: 228673, lat: 34.3917, lng: -118.5426 },
  { name: 'Salem', state_code: 'OR', state_name: 'Oregon', population: 177219, lat: 44.9429, lng: -123.0351 },
  { name: 'Eugene', state_code: 'OR', state_name: 'Oregon', population: 170245, lat: 44.0521, lng: -123.0868 },
  { name: 'Salinas', state_code: 'CA', state_name: 'California', population: 159635, lat: 36.6777, lng: -121.6555 },
  { name: 'Springfield', state_code: 'MA', state_name: 'Massachusetts', population: 153606, lat: 42.1015, lng: -72.5898 },
  { name: 'Pasadena', state_code: 'TX', state_name: 'Texas', population: 151227, lat: 29.6911, lng: -95.1541 },
  { name: 'Rockford', state_code: 'IL', state_name: 'Illinois', population: 147711, lat: 42.2711, lng: -89.0940 },
  { name: 'Pomona', state_code: 'CA', state_name: 'California', population: 151348, lat: 34.0551, lng: -117.7500 },
  { name: 'Hayward', state_code: 'CA', state_name: 'California', population: 162954, lat: 37.6688, lng: -122.0808 },
  { name: 'Alexandria', state_code: 'VA', state_name: 'Virginia', population: 159467, lat: 38.8048, lng: -77.0469 },
  { name: 'Lakewood', state_code: 'CO', state_name: 'Colorado', population: 156798, lat: 39.7047, lng: -105.0814 },
  { name: 'Hollywood', state_code: 'FL', state_name: 'Florida', population: 153067, lat: 26.0112, lng: -80.1495 },
  { name: 'Murfreesboro', state_code: 'TN', state_name: 'Tennessee', population: 146800, lat: 35.8456, lng: -86.3903 },
  { name: 'Essex', state_code: 'MD', state_name: 'Maryland', population: 39315, lat: 39.3099, lng: -76.4744 },
  { name: 'Ann Arbor', state_code: 'MI', state_name: 'Michigan', population: 121510, lat: 42.2808, lng: -83.7430 },
  { name: 'Davenport', state_code: 'IA', state_name: 'Iowa', population: 101724, lat: 41.5236, lng: -90.5776 },
  { name: 'Columbia', state_code: 'SC', state_name: 'South Carolina', population: 127191, lat: 34.0007, lng: -81.0348 },
  { name: 'South Bend', state_code: 'IN', state_name: 'Indiana', population: 102245, lat: 41.6764, lng: -86.2550 },
  { name: 'Beaumont', state_code: 'TX', state_name: 'Texas', population: 119266, lat: 30.0802, lng: -94.1266 },
  { name: 'Wilmington', state_code: 'NC', state_name: 'North Carolina', population: 122162, lat: 34.2257, lng: -77.9447 },
  { name: 'Abilene', state_code: 'TX', state_name: 'Texas', population: 124358, lat: 32.4487, lng: -99.7331 },
  { name: 'Odessa', state_code: 'TX', state_name: 'Texas', population: 123334, lat: 31.8457, lng: -102.3676 },
  { name: 'Killeen', state_code: 'TX', state_name: 'Texas', population: 145516, lat: 31.1171, lng: -97.7278 },
  { name: 'Waterbury', state_code: 'CT', state_name: 'Connecticut', population: 107037, lat: 41.5581, lng: -73.0515 },
  { name: 'Lehigh Acres', state_code: 'FL', state_name: 'Florida', population: 124523, lat: 26.6253, lng: -81.6401 },
  { name: 'West Valley City', state_code: 'UT', state_name: 'Utah', population: 140230, lat: 40.3666, lng: -112.0500 },
  { name: 'Gainesville', state_code: 'FL', state_name: 'Florida', population: 133997, lat: 29.6516, lng: -82.3248 },
  { name: 'Fairfield', state_code: 'CA', state_name: 'California', population: 117149, lat: 38.2494, lng: -122.0399 },
  { name: 'Sunnyvale', state_code: 'CA', state_name: 'California', population: 155805, lat: 37.3688, lng: -122.0363 },
  { name: 'Elgin', state_code: 'IL', state_name: 'Illinois', population: 112058, lat: 42.0354, lng: -88.2826 },
  { name: 'Olathe', state_code: 'KS', state_name: 'Kansas', population: 141470, lat: 38.8814, lng: -94.8191 },
  { name: 'Visalia', state_code: 'CA', state_name: 'California', population: 141384, lat: 36.3302, lng: -119.2921 },
   { name: 'Coral Springs', state_code: 'FL', state_name: 'Florida', population: 133759, lat: 26.2709, lng: -80.2706 },
].map((c: any) => ({
  name: c.name,
  state_code: c.state_code,
  state_name: c.state_name,
  population: c.population,
  lat: c.lat,
  lng: c.lng,
}));

async function seedCities() {
  const db = getDb();

  logger.info({ count: CITIES.length }, 'Seeding cities');

  // Insert in batches
  const batchSize = 50;
  for (let i = 0; i < CITIES.length; i += batchSize) {
    const batch = CITIES.slice(i, i + batchSize);

    const { error } = await db.from('cities').upsert(batch, {
      onConflict: 'name,state_code',
    });

    if (error) {
      logger.error({ error, batch: i }, 'Failed to seed cities batch');
      throw error;
    }

    logger.info({ inserted: Math.min(i + batchSize, CITIES.length), total: CITIES.length }, 'Seeded cities');
  }

  logger.info('Cities seeded successfully');
}

seedCities().catch((error) => {
  logger.error({ error }, 'Failed to seed cities');
  process.exit(1);
});
